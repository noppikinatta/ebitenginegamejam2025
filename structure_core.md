# `@/core` パッケージ構造解説

`@/core` パッケージは、ゲームの核となるロジックとデータ構造を管理します。以下に各ファイルの役割と関連性について詳述します。

## 1. データ構造の基本単位

### `resource.go`
- **`ResourceQuantity`**: ゲーム内の5種類のリソース（金、食料、木材、鉄、マナ）の量を表す構造体。
- 加算、減算、購入可能かどうかの判定メソッドを提供し、ゲーム内経済の基本単位として機能します。

### `turn.go`
- **`Turn`**: ゲームの経過ターン数を表す型。
- ターン数を「N年M月」形式に変換する機能や、次のターンに進める機能など、時間管理の基本的なユーティリティを提供します。

## 2. カードシステム (`card.go`)

ゲームプレイの中核をなすカード関連のロジックが実装されています。

- **`CardPack`**: 市場で購入できるカードパック。開封時に設定された確率に基づいてランダムなカードを排出します。
- **`BattleCard`**: 戦闘で使用するカード。経験値によるレベルアップ機能があり、戦闘力を強化できます。
- **`StructureCard`**: 領地に配置する建造物カード。領地の資源産出量を増やしたり、戦闘を有利にする効果を持ちます。
- **`CardDeck`**: プレイヤーが所持するカード全体を管理します。
- **`CardGenerator`**: カードIDからカードの実体を生成します。
- **スキルシステム**:
    - **`BattleCardSkill`**: `BattleCard` が持つスキル。戦闘中のパワー計算に介入し、非常に多彩な効果（バフ、デバフ、他カードへの影響など）を及ぼします。`BattleCardSkillCalculator` インターフェースを介して具体的な計算ロジックが実装されます。
    - **`YieldModifier`**: `StructureCard` が持つ、領地の資源産出量を変更するスキル。
    - **`BattlefieldModifier`**: `StructureCard` が持つ、戦闘フィールドの特性（カードスロット数など）を変更するスキル。

## 3. ゲームワールドの構成要素

### `mapgrid.go`
- **`MapGrid`**: ゲームのマップ全体を管理します。
- **`Point` インターフェース**: マップ上の各地点を表すインターフェース。通行可能か、自国領かなどの状態を持ちます。
    - **`MyNationPoint`**: プレイヤーの拠点。
    - **`OtherNationPoint`**: NPC国家の拠点。
    - **`WildernessPoint`**: 未開拓の地。敵がおり、征服すると `Territory` になります。
    - **`BossPoint`**: ボスのいる特殊な地点。
- `CanInteract` により、プレイヤーがアクセス可能な範囲を計算・管理します。

### `territory.go`
- **`Territory`**: プレイヤーが征服した `WildernessPoint` を表します。
- `StructureCard` を配置するスロットを持ち、配置されたカードの効果によって資源産出量 (`Yield`) が変動します。

### `nation.go`
- **`Nation` インターフェース**: プレイヤーやNPCなどの国家を表します。
- **`MyNation`**: プレイヤーの国家。基本的な資源産出量を持ちます。
- **`OtherNation`**: NPC国家。
- 各国家は `Market` を持ち、カードパックの売買を行います。

### `market.go`
- **`Market`**: `Nation` が持つ市場。`CardPack` が `MarketItem` として販売されます。
- **`MarketLevel`**: 市場のレベル。高いほど良い商品が並びます。
- **`Treasury`**: `MyNation` が持つ国庫。`ResourceQuantity` を保持し、カード購入時の支払い処理などを行います。

## 4. 戦闘システム

### `enemy.go`
- **`Enemy`**: 戦闘の相手となる敵キャラクター。
- `Power` (戦闘力) と、プレイヤーのカードを弱体化させる様々な `EnemySkill` を持ちます。

### `battle.go`
- **`Battlefield`**: 戦闘が発生した際の「戦場」インスタンス。
- **戦闘の流れ**:
    1. プレイヤーが `BattleCard` を `Battlefield` に配置します。
    2. `CalculateTotalPower` メソッドが、配置されたカードのパワー、カードスキル、敵スキル、隣接領地からの支援効果などをすべて合算し、プレイヤーの総戦闘力を計算します。
    3. この総戦闘力が敵の `Power` を上回れば勝利となります。
- **`BattleCardPowerModifier`**: スキル効果によるパワーの増減（バフ・デバフ）を詳細に管理する構造体。戦闘計算の核心部です。

## 5. ゲーム全体の流れ (`gameflow.go`)

- **`GameState`**: ゲーム全体の進行状況を管理する最も上位の構造体。
- `MyNation`, `CardDeck`, `MapGrid`, `Treasury` など、`core` パッケージ内のほぼすべての主要なデータ構造への参照を保持します。
- `NextTurn` でターンを進め、`AddYield` で資源を収穫し、`IsVictory` で勝利条件を判定するなど、ゲームの大きな流れを制御します。
