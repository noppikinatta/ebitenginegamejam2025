# TDD Implementation Plan - Union Strategy Game

## Project Overview
- Theme: UNION
- Strategy game to build nation alliances
- Technology: Go + Ebitengine + Bamenn
- Screen size: 640x360 (game internal), 1280x720 (display)

## Feature List

### Phase 1: Basic Game Structure ✅
- [x] **F1.1**: Game initialization with Ebitengine
- [x] **F1.2**: Screen layout system (640x360 internal resolution)
- [x] **F1.3**: Scene management system
- [x] **F1.4**: Basic input handling

### Phase 2: Scene System Implementation ✅
- [x] **F2.1**: Title scene with story introduction
- [x] **F2.2**: InGame scene with 5 UI components layout
- [x] **F2.3**: Result scene for game completion
- [x] **F2.4**: Scene transition system

### Phase 3: InGame UI Components ✅
- [x] **F3.1**: ResourceView component (gold, iron, wood, grain, mana)
- [x] **F3.2**: Calendar component (starting from Kingdom Year 1000, Month 4)
- [x] **F3.3**: History component for battle logs
- [x] **F3.4**: CardDeck component for player cards
- [x] **F3.5**: GameMain component container

### Phase 4: GameMain Screens
- [ ] **F4.1**: Map screen with 13x7 grid points
- [ ] **F4.2**: Point types (Home, Wild, NPC Nation, Boss)
- [ ] **F4.3**: Point connectivity and pathfinding
- [ ] **F4.4**: Diplomacy screen for NPC interactions
- [ ] **F4.5**: Battle screen for combat

### Phase 5: Game Logic
- [ ] **F5.1**: Resource management system
- [ ] **F5.2**: Turn-based system (1 turn = 1 month)
- [ ] **F5.3**: Card system (Unit, Enchant, Building types)
- [ ] **F5.4**: Territory control system
- [ ] **F5.5**: Alliance system with NPCs

### Phase 6: Combat System
- [ ] **F6.1**: Card placement system (front/back rows, max 5 each)
- [ ] **F6.2**: Basic combat resolution
- [ ] **F6.3**: Victory/defeat conditions

## Test List

### Phase 1 Tests ✅
- [x] **T1.1**: Test game initializes without errors
- [x] **T1.2**: Test screen resolution is correctly set
- [x] **T1.3**: Test scene manager can switch between scenes
- [x] **T1.4**: Test basic keyboard/mouse input detection

### Phase 2 Tests ✅
- [x] **T2.1**: Test title scene displays correctly
- [x] **T2.2**: Test InGame scene UI layout (5 components in correct positions)
- [x] **T2.3**: Test result scene displays game history
- [x] **T2.4**: Test scene transitions work properly

### Phase 3 Tests ✅
- [x] **T3.1**: Test ResourceView displays all 5 resource types
- [x] **T3.2**: Test Calendar shows correct year/month format
- [x] **T3.3**: Test History component can add and display entries
- [x] **T3.4**: Test CardDeck can display multiple cards horizontally
- [x] **T3.5**: Test GameMain container switches between sub-screens

### Phase 4 Tests
- [ ] **T4.1**: Test Map screen generates 13x7 grid correctly
- [ ] **T4.2**: Test point types are assigned correctly (1 home, 1 boss, multiple wild/NPC)
- [ ] **T4.3**: Test point connectivity rules (can't access blocked paths)
- [ ] **T4.4**: Test Diplomacy screen shows available cards for purchase
- [ ] **T4.5**: Test Battle screen allows card placement

### Phase 5 Tests
- [ ] **T5.1**: Test resource values update correctly
- [ ] **T5.2**: Test turn counter increments monthly
- [ ] **T5.3**: Test card types have correct properties
- [ ] **T5.4**: Test territory control affects resource generation
- [ ] **T5.5**: Test alliance formation with NPCs

### Phase 6 Tests
- [ ] **T6.1**: Test cards can be placed in front/back rows (max 10 total)
- [ ] **T6.2**: Test combat calculates damage correctly
- [ ] **T6.3**: Test victory conditions trigger properly

## Implementation Notes

### Directory Structure
```
/
├── main.go
├── game/
│   ├── game.go
│   ├── scene/
│   │   ├── title.go
│   │   ├── ingame.go
│   │   └── result.go
│   ├── component/
│   │   ├── resource_view.go
│   │   ├── calendar.go
│   │   ├── history.go
│   │   ├── card_deck.go
│   │   └── game_main.go
│   ├── entity/
│   │   ├── card.go
│   │   ├── point.go
│   │   └── resource.go
│   └── system/
│       ├── resource_manager.go
│       ├── turn_manager.go
│       └── combat_manager.go
├── assets/
│   ├── images/
│   └── fonts/
└── test/
    └── *_test.go
```

### Component Layout (InGame Scene)
- GameMain: {0,20,520,280}
- ResourceView: {0,0,520,20}
- Calendar: {520,0,120,40}
- History: {520,80,120,320}
- CardDeck: {0,300,520,60}

### Development Cycle
1. Pick next unchecked feature from Feature List
2. Write corresponding test(s) from Test List
3. Run test (RED) - should fail
4. Implement minimal code to pass test (GREEN)
5. Refactor code while keeping test green (REFACTOR)
6. Mark feature and test as completed
7. Repeat

## Current Sprint: Phase 4
**Goal**: Implement GameMain screens with detailed functionality

**Completed in Phase 1, 2 & 3**:
- ✅ Ebitengine game initialization
- ✅ Screen layout system (640x360)
- ✅ Scene management system
- ✅ Basic input handling
- ✅ Title scene with story introduction
- ✅ InGame scene UI layout (5 components)
- ✅ Result scene with game history
- ✅ Scene transition system
- ✅ ResourceView component (5 resource types)
- ✅ Calendar component (Kingdom Year 1000, Month 4)
- ✅ History component with battle logs
- ✅ CardDeck component with horizontal layout
- ✅ GameMain component container

**Next Actions**:
1. Implement detailed Map screen with 13x7 grid points
2. Create point types (Home, Wild, NPC Nation, Boss)
3. Add point connectivity and pathfinding system
4. Implement Diplomacy screen for NPC interactions
5. Create Battle screen for combat mechanics
